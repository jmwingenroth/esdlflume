---
title: "dowel comparison"
output:
  html_document: default
  pdf_document: 
    latex_engine: xelatex
---

# Libraries:

```{r message=FALSE}

library(tidyverse)

```

# Load data:

```{r message=FALSE}

dowels <- read_csv("../data/raw/1115pumpdata.csv")

dowels1205 <- read_csv("../data/raw/1205pumpdata.csv")

nodowels <- read_csv("../data/raw/1019pumpdata.csv")

dowels0131 <- read_csv("../data/raw/0131pumpdata.csv")

```

# Tidy data:

```{r}

nodowels2 <- nodowels %>%
  select(-X10)

colnames(nodowels2) <- colnames(dowels)

dowels2 <- dowels %>%
  mutate(dowels = 'yes dowels')

nodowels2 <- nodowels2 %>%
  mutate(dowels = 'no dowels')

dowels12052 <- dowels1205 %>%
  mutate(dowels = "yes dowels 2", `mass volume concentration (ppm)` = as.numeric(`mass volume concentration (ppm)`))

dowels0131_2 <- dowels0131 %>%
  select(-Initials, -Initials_1, -Initials_2, -X13) %>%
  mutate(dowels = "yes dowels 3")

colnames(dowels0131_2) <- c(colnames(dowels), "dowels")

data <- rbind(dowels2, nodowels2, dowels12052, dowels0131_2)

tidy <- data %>%
  mutate(`Sample Time` = if_else(dowels == "yes dowels"&`time series` > 2, (`time series` - 3)*300 + 330, as.numeric(`Sample Time`))) %>%
  filter(`Sample Time` < 7000)

tidy <- tidy %>%
  rename(mvc = `mass volume concentration (ppm)`, t = `Sample Time`)


```

# Initial data plot (simple):

```{r}

rm(data, dowels, dowels2, nodowels, nodowels2, dowels12052, dowels1205)

tidy %>%
  ggplot(aes(x = t, y = mvc, color = dowels)) +
  geom_smooth()

```


# Model:

no dowels:

```{r}

ndm <- tidy %>%
  filter(dowels == "no dowels") %>%
  lm(log(mvc) ~ t, data = .)

summary(ndm)
  
```

dowels:

```{r}

ydm <- tidy %>%
  filter(dowels == "yes dowels") %>%
  lm(log(mvc) ~ t, data = .)

summary(ydm)

```

# Graph with models overlaid

```{r}

tidy %>%
  filter(dowels!="yes dowels 3") %>%
  ggplot(aes(x = t, y = mvc, color = dowels, group = t)) +
  geom_point(alpha = .2) +
  stat_function(fun = function(x) exp(coef(ndm)[1]+coef(ndm)[2]*x), color = "red", size = 0.05) +
  stat_function(fun = function(x) exp(coef(ydm)[1]+coef(ydm)[2]*x), color = "blue", size = 0.05) +
  xlim(c(0,NA)) +
  scale_color_manual(values = c("red", "blue", "green"))

```

